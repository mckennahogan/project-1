---
title: "Bootstrapping Diabetes Data to Illuminate Factors Final Paper"
author: "Jorie Alvis, McKenna Hogan, and Cadeon Ott"
output: pdf_document

---

```{r libraries, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(knitr)
library(dplyr)
library(simpleboot)
library(boot) 
library(kableExtra)
library(patchwork)
library("cowplot")
library(gridExtra)
library(cowplot)
set.seed(400)
```


# Dataset

We got our dataset from kaggle:

The dataset consisted of health indicators for people with no diabetes, prediabetes, and diabetes.We chose to focus on the variables HighBP, HighChol, BMI, AnyHealthcare, GenHlth, and Income out of the 21 factors in the dataset

 - High BP, HighChol, and AnyHealthcare are binary
 
 - GenHlth has 5 levels
 
 - BMI and Income are continuous 

```{r KenData, message=FALSE, warning=FALSE, include=FALSE}
#skewed data
diab.data1<- read_csv("../../data/diabetes_012_health_indicators_BRFSS2015.csv")
#unskewed data
diab.data2<- 
  read_csv("../../data/diabetes_binary_5050split_health_indicators_BRFSS2015.csv")
diab.data3<- read_csv("../../data/diabetes_binary_health_indicators_BRFSS2015.csv")

nodiab.only.1<-diab.data1|>
  filter(Diabetes_012==0)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
prediab.only.1<-diab.data1|>
  filter(Diabetes_012==1)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
diab.only.1<-diab.data1|>
  filter(Diabetes_012==2)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
```

```{r echo=FALSE, out.width = '70%', message=FALSE, warning=FALSE}
ggplot(data=diab.data1)+
  geom_bar(aes(x=Diabetes_012), fill="blue")+
  labs(x="No Diabetes                       Prediabetes                        Diabetes",
       title="Diabetes Data")
```

# Methods

We decided to bootstrap our data because there was a massive difference in sample sizes for the 3 classifications of patients. We utilized all 5 types of bootsrapping. 


## Percentile and Basic

For the percentile and basic bootstrapping, I decided to focus on the difference in means and seeing if there was any difference between the two types of bootstrapping to check my assumptions bout biasness. If there was a large difference between my methods, that would have meant there was bias in the sample. My calculations showed no bias so I wanted to make sure that my bootstrapping methods matched this finding. I used R=1000 for each bootstrap and found the difference in means for each variable for the 3 combinations of no diabetes, prediabetes, and diabetes.

## Normal and Studentized

## BCa

# Results

## Percentile and Basic

```{r KenData2, message=FALSE, warning=FALSE, include=FALSE}
#skewed data
diab.data1<- read_csv("../../data/diabetes_012_health_indicators_BRFSS2015.csv")
#unskewed data
diab.data2<- 
  read_csv("../../data/diabetes_binary_5050split_health_indicators_BRFSS2015.csv")
diab.data3<- read_csv("../../data/diabetes_binary_health_indicators_BRFSS2015.csv")

nodiab.only.1<-diab.data1|>
  filter(Diabetes_012==0)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
prediab.only.1<-diab.data1|>
  filter(Diabetes_012==1)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
diab.only.1<-diab.data1|>
  filter(Diabetes_012==2)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
```

```{r new function data, message=FALSE, warning=FALSE, include=FALSE}

HighBP0<-nodiab.only.1$HighBP
HighBP1<-prediab.only.1$HighBP
HighBP2<-diab.only.1$HighBP

HighChol0<-nodiab.only.1$HighChol
HighChol1<-prediab.only.1$HighChol
HighChol2<-diab.only.1$HighChol

BMI0<-nodiab.only.1$BMI
BMI1<-prediab.only.1$BMI
BMI2<-diab.only.1$BMI

AnyHealthcare0<-nodiab.only.1$AnyHealthcare
AnyHealthcare1<-prediab.only.1$AnyHealthcare
AnyHealthcare2<-diab.only.1$AnyHealthcare

GenHlth0<-nodiab.only.1$GenHlth
GenHlth1<-prediab.only.1$GenHlth
GenHlth2<-diab.only.1$GenHlth

Income0<-nodiab.only.1$Income
Income1<-prediab.only.1$Income
Income2<-diab.only.1$Income

```

```{r function, message=FALSE, warning=FALSE, include=FALSE}
diff.means<-function(data0,data1,data2,R){
  
  
  no_pre<- two.boot(data0, data1, "mean", R = R)
  pre_diab<- two.boot(data1, data2, "mean", R = R)
  diab_no<- two.boot(data2, data0, "mean", R = R)
  
  se.no_pre<-sd(no_pre$t)
  se.pre_diab<-sd(pre_diab$t)
  se.diab_no<-sd(diab_no$t)
  
  bias.no_pre<-rep(NA,R)
  bias.pre_diab<-rep(NA,R)
  bias.diab_no<-rep(NA,R)
  for (i in 1:R){
    bias.no_pre[i]<-no_pre$t[i]-no_pre$t0
    bias.pre_diab[i]<-pre_diab$t[i]-pre_diab$t0
    bias.diab_no[i]<-diab_no$t[i]-diab_no$t0
  }
  bias.no_pre<-mean(bias.no_pre)
  bias.pre_diab<-mean(bias.pre_diab)
  bias.diab_no<-mean(bias.diab_no)
  
  boot.no_pre<-boot.ci(no_pre,type=c("perc","basic"))
  boot.pre_diab<-boot.ci(pre_diab,type=c("perc","basic"))
  boot.diab_no<-boot.ci(diab_no,type=c("perc","basic"))
  
  plot.no_pre<-ggplot() +
    geom_histogram(aes(no_pre$t), fill="darkgoldenrod1") +
    geom_segment(aes(y=25,yend=25,x=boot.no_pre$percent[4],
                     xend=boot.no_pre$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.no_pre$basic[4],
                     xend=boot.no_pre$basic[5],col="basic"),size=1.5)+
    xlab("mean(no diabetes) - mean(prediabetes)")
  
  plot.pre_diab<-ggplot() +
    geom_histogram(aes(pre_diab$t),fill="deepskyblue") +
    geom_segment(aes(y=25,yend=25,x=boot.pre_diab$percent[4],
                     xend=boot.pre_diab$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.pre_diab$basic[4],
                     xend=boot.pre_diab$basic[5],col="basic"),size=1.5)+
    xlab("mean(prediabetes) - mean(diabetes)")
  plot.diab_no<-ggplot() +
    geom_histogram(aes(diab_no$t),fill="coral") +
    geom_segment(aes(y=25,yend=25,x=boot.diab_no$percent[4],
                     xend=boot.diab_no$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.diab_no$basic[4],
                     xend=boot.diab_no$basic[5],col="basic"),size=1.5)+
    xlab("mean(diabetes) - mean(no diabetes)")

  mean.no_pre<-mean(no_pre$t)
  mean.pre_diab<-mean(pre_diab$t)
  mean.diab_no<-mean(diab_no$t)
  return(list(plot.no_pre, boot.no_pre,
              plot.pre_diab, boot.pre_diab,
              plot.diab_no, boot.diab_no,
              mean.no_pre,mean.pre_diab,mean.diab_no))
}

```

```{r calling each variable, message=FALSE, warning=FALSE, include=FALSE, cache=T}
HighBP.list<-diff.means(HighBP0,HighBP1,HighBP2,1000)

HighChol.list<-diff.means(HighChol0,HighChol1,HighChol2,1000)

BMI.list<-diff.means(BMI0,BMI1,BMI2,1000)

AnyHealthcare.list<-diff.means(AnyHealthcare0,AnyHealthcare1,AnyHealthcare2,1000)

GenHlth.list<-diff.means(GenHlth0,GenHlth1,GenHlth2,1000)

Income.list<-diff.means(Income0,Income1,Income2,1000)

```

```{r making kables, message=FALSE, warning=FALSE, include=FALSE}
no_pre.row1<-c(HighBP.list[[7]],HighBP.list[[2]][["percent"]][[4]],
              HighBP.list[[2]][["percent"]][[5]],
        HighBP.list[[2]][["basic"]][[4]],HighBP.list[[2]][["basic"]][[5]])
no_pre.row2<-c(HighChol.list[[7]],HighChol.list[[2]][["percent"]][[4]],
        HighChol.list[[2]][["percent"]][[5]],
        HighChol.list[[2]][["basic"]][[4]],HighChol.list[[2]][["basic"]][[5]])
no_pre.row3<-c(BMI.list[[7]],BMI.list[[2]][["percent"]][[4]],BMI.list[[2]][["percent"]][[5]],
        BMI.list[[2]][["basic"]][[4]],BMI.list[[2]][["basic"]][[5]])
no_pre.row4<-c(AnyHealthcare.list[[7]],AnyHealthcare.list[[2]][["percent"]][[4]],
        AnyHealthcare.list[[2]][["percent"]][[5]],
        AnyHealthcare.list[[2]][["basic"]][[4]],AnyHealthcare.list[[2]][["basic"]][[5]])
no_pre.row5<-c(GenHlth.list[[7]],GenHlth.list[[2]][["percent"]][[4]],
        GenHlth.list[[2]][["percent"]][[5]],
        GenHlth.list[[2]][["basic"]][[4]],GenHlth.list[[2]][["basic"]][[5]])
no_pre.row6<-c(Income.list[[7]],Income.list[[2]][["percent"]][[4]],
               Income.list[[2]][["percent"]][[5]],
        Income.list[[2]][["basic"]][[4]],Income.list[[2]][["basic"]][[5]])

no_pre.table<-rbind(no_pre.row1,no_pre.row2,no_pre.row3,no_pre.row4,no_pre.row5,no_pre.row6)
rownames(no_pre.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(no_pre.table)<-c("mean","low percentile","high percentile","low basic","high basic")
no_pre.kable<-kable(no_pre.table,caption="No Diabetes - Prediabetes",
                    digits=3,align="c")|>
  kable_paper("hover", full_width = F)

##

pre_diab.row1<-c(HighBP.list[[8]],HighBP.list[[2]][["percent"]][[4]],
              HighBP.list[[4]][["percent"]][[5]],
        HighBP.list[[2]][["basic"]][[4]],HighBP.list[[2]][["basic"]][[5]])
pre_diab.row2<-c(HighChol.list[[8]],HighChol.list[[4]][["percent"]][[4]],
        HighChol.list[[4]][["percent"]][[5]],
        HighChol.list[[4]][["basic"]][[4]],HighChol.list[[4]][["basic"]][[5]])
pre_diab.row3<-c(BMI.list[[8]],BMI.list[[4]][["percent"]][[4]],BMI.list[[4]][["percent"]][[5]],
        BMI.list[[4]][["basic"]][[4]],BMI.list[[4]][["basic"]][[5]])
pre_diab.row4<-c(AnyHealthcare.list[[8]],AnyHealthcare.list[[4]][["percent"]][[4]],
        AnyHealthcare.list[[4]][["percent"]][[5]],
        AnyHealthcare.list[[4]][["basic"]][[4]],AnyHealthcare.list[[2]][["basic"]][[5]])
pre_diab.row5<-c(GenHlth.list[[8]],GenHlth.list[[2]][["percent"]][[4]],
        GenHlth.list[[4]][["percent"]][[5]],
        GenHlth.list[[4]][["basic"]][[4]],GenHlth.list[[4]][["basic"]][[5]])
pre_diab.row6<-c(Income.list[[8]],Income.list[[4]][["percent"]][[4]],
               Income.list[[4]][["percent"]][[5]],
        Income.list[[4]][["basic"]][[4]],Income.list[[4]][["basic"]][[5]])

pre_diab.table<-rbind(pre_diab.row1,pre_diab.row2,pre_diab.row3,
                      pre_diab.row4,pre_diab.row5,pre_diab.row6)
rownames(pre_diab.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(pre_diab.table)<-c("mean","low percentile","high percentile","low basic","high basic")
pre_diab.kable<-kable(pre_diab.table,caption="Prediabetes - Diabetes",
                    digits=3,align="c")|>
  kable_paper("hover", full_width = F)

##

diab_no.row1<-c(HighBP.list[[9]],HighBP.list[[6]][["percent"]][[4]],
              HighBP.list[[6]][["percent"]][[5]],
        HighBP.list[[6]][["basic"]][[4]],HighBP.list[[6]][["basic"]][[5]])
diab_no.row2<-c(HighChol.list[[9]],HighChol.list[[6]][["percent"]][[4]],
        HighChol.list[[6]][["percent"]][[5]],
        HighChol.list[[6]][["basic"]][[4]],HighChol.list[[6]][["basic"]][[5]])
diab_no.row3<-c(BMI.list[[9]],BMI.list[[6]][["percent"]][[4]],BMI.list[[6]][["percent"]][[5]],
        BMI.list[[6]][["basic"]][[4]],BMI.list[[6]][["basic"]][[5]])
diab_no.row4<-c(AnyHealthcare.list[[9]],AnyHealthcare.list[[6]][["percent"]][[4]],
        AnyHealthcare.list[[6]][["percent"]][[5]],
        AnyHealthcare.list[[6]][["basic"]][[4]],AnyHealthcare.list[[6]][["basic"]][[5]])
diab_no.row5<-c(GenHlth.list[[9]],GenHlth.list[[6]][["percent"]][[4]],
        GenHlth.list[[6]][["percent"]][[5]],
        GenHlth.list[[6]][["basic"]][[4]],GenHlth.list[[6]][["basic"]][[5]])
diab_no.row6<-c(Income.list[[9]],Income.list[[6]][["percent"]][[4]],
               Income.list[[2]][["percent"]][[5]],
        Income.list[[6]][["basic"]][[4]],Income.list[[6]][["basic"]][[5]])

diab_no.table<-rbind(diab_no.row1,diab_no.row2,diab_no.row3,diab_no.row4,
                     diab_no.row5,diab_no.row6)
rownames(diab_no.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(diab_no.table)<-c("mean","low percentile","high percentile","low basic","high basic")
diab_no.kable<-kable(diab_no.table,caption="Diabetes - No Diabetes",
                    digits=3,align="c")|>
  kable_paper("hover", full_width = F)

```


In my results, I found that there was a significant difference in means for most of my combinations. The only variable that didn't have consistent significant difference in means was the AnyHealthcare variable. I also found that the percentile and basic bootstraps were very similar which matched both my assumption and my findings for 0 SE. 

The following are tables showing the mean difference among the combinations of no diabetes, prediabetes, and diabetes for all the varibles and for both kinds of bootstrapping:

```{r echo=FALSE, message=FALSE, warning=FALSE}
no_pre.kable
pre_diab.kable
diab_no.kable
```

The following are the histograms for each combination of difference in means:


## Normal and Studentized

## BCa

# Overall Results