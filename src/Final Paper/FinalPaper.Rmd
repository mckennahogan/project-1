---
title: "Bootstrapping Diabetes Data to Illuminate Factors"
author: "Jorie Alvis, McKenna Hogan, and Cadeon Ott"
geometry: margin=1cm
output: html_document
---

```{r libraries, message=FALSE, warning=FALSE, include=FALSE}
library(tidyverse)
library(knitr)
library(dplyr)
library(simpleboot)
library(boot) 
library(kableExtra)
library(patchwork)
library(gridExtra)
library(cowplot)

set.seed(400)
```

# Introduction

Given the freedom in the requirements for this project, our team decided to tackle each bootstrapping method we learned in class to gain insights into a single dataset and learn more about each bootstrapping method. This class had shown us how to use these methods, when to use these methods, and the pros and cons of each method. Some differences between the methods are subtle (like basic and percentile), and some methods have major drawbacks (like BCa and Bootstrap `t`). In this paper, we will go over each method, some implemented by hand, and compare them against each other and to a skewed dataset.

The algorithms Standard Normal, Studentized, and BCa were coded by hand, and during the many hour process, we learned the nuances of these algorithms and the effort it takes to mitigate errors. Our team used this project to not only showcase the knowledge gained from this class, but to also expand our experience with these algorithms.

# Dataset

## Overview
We got our dataset from kaggle:

The dataset consisted of health indicators for people with no diabetes, prediabetes, and diabetes.We chose to focus on the variables HighBP, HighChol, BMI, AnyHealthcare, GenHlth, and Income out of the 21 factors in the dataset

 - High BP, HighChol, and AnyHealthcare are binary
 
 - GenHlth has 5 levels
 
 - BMI and Income are continuous 

```{r DataInit, message=FALSE, warning=FALSE, include=FALSE}
# This data has three classes
## No-diabetes: Most observations
## Pre-diabetes: Least observations
## Diabetes: Response of importance
data.main = read_csv("../../data/diabetes_012_health_indicators_BRFSS2015.csv")
data.main = data.main %>% rename("Diabetes"="Diabetes_012")
data.main$Diabetes = as.factor(data.main$Diabetes)

nodiab.only.1<-data.main|>
  filter(Diabetes==0)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
prediab.only.1<-data.main|>
  filter(Diabetes==1)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
diab.only.1<-data.main|>
  filter(Diabetes==2)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
```

```{r echo=FALSE, out.width = '70%', message=FALSE, warning=FALSE}
ggplot(data=data.main)+
  geom_bar(aes(x=Diabetes, y=..count../sum(..count..)), fill="blue")+
  labs(x=c("No Diabetes, Prediabetes, Diabetes"), y="Frequency", 
       title="Diabetes Data")
```

This graph showcases the differences in the number of observations between classifications. To analyze important factors that could indicate diabetes, we wanted to compare the distributions of each factors within the classes, but with this disparity, we thought bootstrapping would mitigate any issues that arise from the dramatic difference.

## Exploration

```{r Explore, echo=FALSE, message=FALSE, warning=FALSE}
p_BP = ggplot(data=data.main) +
  geom_histogram(aes(x=HighBP, y=..count../sum(..count..), fill=Diabetes), position="identity")+
  labs(x="HighBP", y="Frequency")
p_HighChol = ggplot(data=data.main) +
  geom_histogram(aes(x=HighChol, y=..count../sum(..count..), fill=Diabetes), position="identity")+
  labs(x="HighChol", y="Frequency")
p_BMI = ggplot(data=data.main) +
  geom_histogram(aes(x=BMI, y=..count../sum(..count..), fill=Diabetes), position="identity")+
  labs(x="BMI", y="Frequency")
p_AnyHlth = ggplot(data=data.main) +
  geom_histogram(aes(x=AnyHealthcare, y=..count../sum(..count..), fill=Diabetes), position="identity")+
  labs(x="AnyHealthcare", y="Frequency")
p_GenHlth = ggplot(data=data.main) +
  geom_histogram(aes(x=GenHlth, y=..count../sum(..count..), fill=Diabetes), position="identity")+
  labs(x="GenHlth", y="Frequency")
p_Income = ggplot(data=data.main) +
  geom_histogram(aes(x=Income, y=..count../sum(..count..), fill=Diabetes),
                 position="identity", bins=40)+
  labs(x="Income", y="Frequency")

p_BP + p_HighChol + p_BMI + p_AnyHlth + p_GenHlth + p_Income +
  plot_layout(ncol=2, guides="collect")&
  theme(legend.position = 'bottom')
```

At a quick glance, we can see that there may be some difference between the classes, but with the frequency disparity (pre-diabetes doesn't even show), we cannot come to any conclusions.

# Methods

We decided to bootstrap our data because there was a massive difference in sample sizes for the 3 classifications of patients. We utilized all 5 types of bootstrapping. 

## Percentile and Basic

```{r new function data, message=FALSE, warning=FALSE, include=FALSE}
HighBP0<-nodiab.only.1$HighBP
HighBP1<-prediab.only.1$HighBP
HighBP2<-diab.only.1$HighBP

HighChol0<-nodiab.only.1$HighChol
HighChol1<-prediab.only.1$HighChol
HighChol2<-diab.only.1$HighChol

BMI0<-nodiab.only.1$BMI
BMI1<-prediab.only.1$BMI
BMI2<-diab.only.1$BMI

AnyHealthcare0<-nodiab.only.1$AnyHealthcare
AnyHealthcare1<-prediab.only.1$AnyHealthcare
AnyHealthcare2<-diab.only.1$AnyHealthcare

GenHlth0<-nodiab.only.1$GenHlth
GenHlth1<-prediab.only.1$GenHlth
GenHlth2<-diab.only.1$GenHlth

Income0<-nodiab.only.1$Income
Income1<-prediab.only.1$Income
Income2<-diab.only.1$Income

```

```{r function, message=FALSE, warning=FALSE, include=FALSE}
diff.means<-function(data0,data1,data2,R){
  
  
  no_pre<- two.boot(data0, data1, "mean", R = R)
  pre_diab<- two.boot(data1, data2, "mean", R = R)
  diab_no<- two.boot(data2, data0, "mean", R = R)
  
  se.no_pre<-sd(no_pre$t)
  se.pre_diab<-sd(pre_diab$t)
  se.diab_no<-sd(diab_no$t)
  
  bias.no_pre<-rep(NA,R)
  bias.pre_diab<-rep(NA,R)
  bias.diab_no<-rep(NA,R)
  for (i in 1:R){
    bias.no_pre[i]<-no_pre$t[i]-no_pre$t0
    bias.pre_diab[i]<-pre_diab$t[i]-pre_diab$t0
    bias.diab_no[i]<-diab_no$t[i]-diab_no$t0
  }
  bias.no_pre<-mean(bias.no_pre)
  bias.pre_diab<-mean(bias.pre_diab)
  bias.diab_no<-mean(bias.diab_no)
  
  boot.no_pre<-boot.ci(no_pre,type=c("perc","basic"))
  boot.pre_diab<-boot.ci(pre_diab,type=c("perc","basic"))
  boot.diab_no<-boot.ci(diab_no,type=c("perc","basic"))
  
  plot.no_pre<-ggplot() +
    geom_histogram(aes(no_pre$t), fill="darkgoldenrod1") +
    geom_segment(aes(y=25,yend=25,x=boot.no_pre$percent[4],
                     xend=boot.no_pre$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.no_pre$basic[4],
                     xend=boot.no_pre$basic[5],col="basic"),size=1.5)+
    xlab("no-diabetes - pre-diabetes")
  
  plot.pre_diab<-ggplot() +
    geom_histogram(aes(pre_diab$t),fill="deepskyblue") +
    geom_segment(aes(y=25,yend=25,x=boot.pre_diab$percent[4],
                     xend=boot.pre_diab$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.pre_diab$basic[4],
                     xend=boot.pre_diab$basic[5],col="basic"),size=1.5)+
    xlab("pre-diabetes - diabetes")
  plot.diab_no<-ggplot() +
    geom_histogram(aes(diab_no$t),fill="coral") +
    geom_segment(aes(y=25,yend=25,x=boot.diab_no$percent[4],
                     xend=boot.diab_no$percent[5], col="percentile"),size=1.5)+
    geom_segment(aes(y=35,yend=35,x=boot.diab_no$basic[4],
                     xend=boot.diab_no$basic[5],col="basic"),size=1.5)+
    xlab("diabetes - no-diabetes")

  
  mean.no_pre<-mean(no_pre$t)
  mean.pre_diab<-mean(pre_diab$t)
  mean.diab_no<-mean(diab_no$t)
    
  return(list(plot.no_pre, boot.no_pre,
              plot.pre_diab, boot.pre_diab,
              plot.diab_no, boot.diab_no,
              mean.no_pre,mean.pre_diab,mean.diab_no))
}

```

```{r calling each variable, message=FALSE, warning=FALSE, include=FALSE, cache=T}
HighBP.list<-diff.means(HighBP0,HighBP1,HighBP2,1000)

HighChol.list<-diff.means(HighChol0,HighChol1,HighChol2,1000)

BMI.list<-diff.means(BMI0,BMI1,BMI2,1000)

AnyHealthcare.list<-diff.means(AnyHealthcare0,AnyHealthcare1,AnyHealthcare2,1000)

GenHlth.list<-diff.means(GenHlth0,GenHlth1,GenHlth2,1000)

Income.list<-diff.means(Income0,Income1,Income2,1000)

```

```{r making kables, message=FALSE, warning=FALSE, include=FALSE}
no_pre.row1<-c(HighBP.list[[7]],HighBP.list[[2]][["percent"]][[4]],
              HighBP.list[[2]][["percent"]][[5]],
        HighBP.list[[2]][["basic"]][[4]],HighBP.list[[2]][["basic"]][[5]])
no_pre.row2<-c(HighChol.list[[7]],HighChol.list[[2]][["percent"]][[4]],
        HighChol.list[[2]][["percent"]][[5]],
        HighChol.list[[2]][["basic"]][[4]],HighChol.list[[2]][["basic"]][[5]])
no_pre.row3<-c(BMI.list[[7]],BMI.list[[2]][["percent"]][[4]],BMI.list[[2]][["percent"]][[5]],
        BMI.list[[2]][["basic"]][[4]],BMI.list[[2]][["basic"]][[5]])
no_pre.row4<-c(AnyHealthcare.list[[7]],AnyHealthcare.list[[2]][["percent"]][[4]],
        AnyHealthcare.list[[2]][["percent"]][[5]],
        AnyHealthcare.list[[2]][["basic"]][[4]],AnyHealthcare.list[[2]][["basic"]][[5]])
no_pre.row5<-c(GenHlth.list[[7]],GenHlth.list[[2]][["percent"]][[4]],
        GenHlth.list[[2]][["percent"]][[5]],
        GenHlth.list[[2]][["basic"]][[4]],GenHlth.list[[2]][["basic"]][[5]])
no_pre.row6<-c(Income.list[[7]],Income.list[[2]][["percent"]][[4]],
               Income.list[[2]][["percent"]][[5]],
        Income.list[[2]][["basic"]][[4]],Income.list[[2]][["basic"]][[5]])

no_pre.table<-rbind(no_pre.row1,no_pre.row2,no_pre.row3,no_pre.row4,no_pre.row5,no_pre.row6)
rownames(no_pre.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(no_pre.table)<-c("mean","low percentile","high percentile","low basic","high basic")
no_pre.kable<-kable(no_pre.table,caption="No Diabetes - Prediabetes",
                    digits=3,align="c") |> kable_paper("hover", full_width = F)

##

pre_diab.row1<-c(HighBP.list[[8]],HighBP.list[[2]][["percent"]][[4]],
              HighBP.list[[4]][["percent"]][[5]],
        HighBP.list[[2]][["basic"]][[4]],HighBP.list[[2]][["basic"]][[5]])
pre_diab.row2<-c(HighChol.list[[8]],HighChol.list[[4]][["percent"]][[4]],
        HighChol.list[[4]][["percent"]][[5]],
        HighChol.list[[4]][["basic"]][[4]],HighChol.list[[4]][["basic"]][[5]])
pre_diab.row3<-c(BMI.list[[8]],BMI.list[[4]][["percent"]][[4]],BMI.list[[4]][["percent"]][[5]],
        BMI.list[[4]][["basic"]][[4]],BMI.list[[4]][["basic"]][[5]])
pre_diab.row4<-c(AnyHealthcare.list[[8]],AnyHealthcare.list[[4]][["percent"]][[4]],
        AnyHealthcare.list[[4]][["percent"]][[5]],
        AnyHealthcare.list[[4]][["basic"]][[4]],AnyHealthcare.list[[2]][["basic"]][[5]])
pre_diab.row5<-c(GenHlth.list[[8]],GenHlth.list[[2]][["percent"]][[4]],
        GenHlth.list[[4]][["percent"]][[5]],
        GenHlth.list[[4]][["basic"]][[4]],GenHlth.list[[4]][["basic"]][[5]])
pre_diab.row6<-c(Income.list[[8]],Income.list[[4]][["percent"]][[4]],
               Income.list[[4]][["percent"]][[5]],
        Income.list[[4]][["basic"]][[4]],Income.list[[4]][["basic"]][[5]])

pre_diab.table<-rbind(pre_diab.row1,pre_diab.row2,pre_diab.row3,
                      pre_diab.row4,pre_diab.row5,pre_diab.row6)
rownames(pre_diab.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(pre_diab.table)<-c("mean","low percentile","high percentile","low basic","high basic")
pre_diab.kable<-kable(pre_diab.table,caption="Prediabetes - Diabetes",
                    digits=3,align="c")|>
  kable_paper("hover", full_width = F)

##

diab_no.row1<-c(HighBP.list[[9]],HighBP.list[[6]][["percent"]][[4]],
              HighBP.list[[6]][["percent"]][[5]],
        HighBP.list[[6]][["basic"]][[4]],HighBP.list[[6]][["basic"]][[5]])
diab_no.row2<-c(HighChol.list[[9]],HighChol.list[[6]][["percent"]][[4]],
        HighChol.list[[6]][["percent"]][[5]],
        HighChol.list[[6]][["basic"]][[4]],HighChol.list[[6]][["basic"]][[5]])
diab_no.row3<-c(BMI.list[[9]],BMI.list[[6]][["percent"]][[4]],BMI.list[[6]][["percent"]][[5]],
        BMI.list[[6]][["basic"]][[4]],BMI.list[[6]][["basic"]][[5]])
diab_no.row4<-c(AnyHealthcare.list[[9]],AnyHealthcare.list[[6]][["percent"]][[4]],
        AnyHealthcare.list[[6]][["percent"]][[5]],
        AnyHealthcare.list[[6]][["basic"]][[4]],AnyHealthcare.list[[6]][["basic"]][[5]])
diab_no.row5<-c(GenHlth.list[[9]],GenHlth.list[[6]][["percent"]][[4]],
        GenHlth.list[[6]][["percent"]][[5]],
        GenHlth.list[[6]][["basic"]][[4]],GenHlth.list[[6]][["basic"]][[5]])
diab_no.row6<-c(Income.list[[9]],Income.list[[6]][["percent"]][[4]],
               Income.list[[2]][["percent"]][[5]],
        Income.list[[6]][["basic"]][[4]],Income.list[[6]][["basic"]][[5]])

diab_no.table<-rbind(diab_no.row1,diab_no.row2,diab_no.row3,diab_no.row4,
                     diab_no.row5,diab_no.row6)
rownames(diab_no.table)<-c("HighBP","HighChol","BMI","AnyHealthcare","GenHlth","Income")
colnames(diab_no.table)<-c("mean","low percentile","high percentile","low basic","high basic")
diab_no.kable<-kable(diab_no.table,caption="Diabetes - No Diabetes",
                    digits=3,align="c")|>
  kable_paper("hover", full_width = F)

```

In my results, I found that there was a significant difference in means for most of my combinations. The only variable that didn't have consistent significant difference in means was the AnyHealthcare variable. I also found that the percentile and basic bootstraps were very similar which matched both my assumption and my findings for 0 SE. 

The following are tables showing the difference in means among the combinations of no diabetes, prediabetes, and diabetes for all the variables and for both kinds of bootstrapping:

```{r echo=FALSE, message=FALSE, warning=FALSE, out.height='50%',out.height='50%'}
no_pre.kable
pre_diab.kable
diab_no.kable
```

The following are the histograms for each combination of difference in means for:

```{r echo=FALSE, message=FALSE, warning=FALSE}
HighBP.list[[1]]+HighBP.list[[3]]+HighBP.list[[5]] +
  plot_annotation(title="High Blood Pressure") +
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
HighChol.list[[1]] + HighChol.list[[3]] + HighChol.list[[5]] +
  plot_annotation(title="High Cholesterol")+
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
BMI.list[[1]] + BMI.list[[3]] + BMI.list[[5]] +
  plot_annotation(title="Body Mass Index (BMI)")+
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
GenHlth.list[[1]]+GenHlth.list[[3]]+GenHlth.list[[5]] +
  plot_annotation(title="General Health")+
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
AnyHealthcare.list[[1]]+AnyHealthcare.list[[3]]+AnyHealthcare.list[[5]] +
  plot_annotation(title="Any Healthcare (Indicator)")+
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
Income.list[[1]]+Income.list[[3]]+Income.list[[5]] +
  plot_annotation(title="Income")+
  plot_layout(ncol=3, guides="collect")&theme(legend.position = 'bottom')
```

As you can see from these histograms, 0 is almost never included in the interval. The only times 0 is in the interval is for AnyHealthcare. This means that the difference in means between no no diabetes and pre-diabetes, pre-diabetes and diabetes, and diabetes and no diabetes are significant for every variable but AnyHealthcare. The fact that the basic and percentile CI's are extremely similar show that there is no bias in the samples. This matched the outputted values for SE.


### Results

For the percentile and basic bootstrapping, I decided to focus on the difference in means and seeing if there was any difference between the two types of bootstrapping to check my assumptions bout biasness. If there was a large difference between my methods, that would have meant there was bias in the sample. My calculations showed no bias so I wanted to make sure that my bootstrapping methods matched this finding. I used R=1000 for each bootstrap and found the difference in means for each variable for the 3 combinations of no diabetes, prediabetes, and diabetes.

## Normal and Studentized

### Bootstrap Sampleing
The code bellow shows the algorithm we used to sample from the data

```{r BootSampleFunc, echo=TRUE, message=FALSE, warning=FALSE}
bootSample = function(data, m, n) {
  ret = list()
  for (i in 1:m) {
    # Sample of size n for No Diabetes
    sample.no_d = sample(1:length(data[data$Diabetes == 0,]), size=n, replace=TRUE)
    data.sample.no_d = data[data$Diabetes == 0,][sample.no_d,]
    
    # Sample of size n for Pre-Diabetes
    sample.pre_d = sample(1:length(data[data$Diabetes == 1,]), size=n, replace=TRUE)
    data.sample.pre_d = data[data$Diabetes == 1,][sample.pre_d,]
    
    # Sample of size n for Diabetes
    sample.d = sample(1:length(data[data$Diabetes == 2,]), size=n, replace=TRUE)
    data.sample.d = data[data$Diabetes == 2,][sample.d,]
    
    # Row bind the three samples
    data.sample = rbind(data.sample.no_d, data.sample.pre_d, data.sample.d)
    
    ret[[i]] = data.sample
  }
  
  return(ret)
}
```

### Standard Normal Bootstrap CI Code

The Standard Normal Bootstrap CI uses the mean of each sample to estimate a standard error for $\hat{\theta}$ and creates a confidence interval using the Standard Normal Distribution around it.\newline

$S_1,S_2,...,S_m\sim\text{Data}$\newline

$\hat{\theta}_m=\text{mean}(S_m)$\newline

$\hat{\theta}=\text{mean}(\hat{\theta}_1,\hat{\theta}_2,...)\text{ and }\hat{\text{se}}(\hat{\theta})=\text{sd}(\hat{\theta}_1,\hat{\theta}_2,...)$\newline

The interval is $\hat{\theta}\pm z_{\alpha/2}\hat{\text{ se}}(\hat{\theta})$

```{r NormalBoot, echo=TRUE, message=FALSE, warning=FALSE}
normal_boot = function(data_list, factors) {
  # The returned list sorted by:
  ## Name of Factor, Class of Diabetes, each sample in the bootstrap
  ret = list()
  
  # For each factor of interest
  for (col_name in factors) {
    # List of combined statistics for each class of diabetes and individual sample
    combo = list()
    
    # For each class of diabetes
    for (d in 0:2) {
      # The data frame of statistics for each sample
      data.stats = setNames(data.frame(matrix(ncol = 4, nrow = length(data_list))),
                            c("mean", "sd", "lower", "upper"))
      
      # For each sample
      for (i in 1:length(data_list)) {
        data.sample = data_list[[i]] %>% filter(Diabetes==d) %>% pull(col_name)
        
        data.mean = mean(data.sample)
        data.sd = sd(data.sample)
        
        delta = pnorm((1-0.95/2))*data.sd
        data.lower = data.mean-delta
        data.upper = data.mean+delta
        
        data.stats[i,] = c(data.mean, data.sd, data.lower, data.upper)
      }
      # Calculate the statistics across all the samples
      theta.hat = mean(data.stats$mean)
      theta.se = sd(data.stats$mean)
      
      delta = pnorm((1-0.95/2))*theta.se
      theta.lower = theta.hat-delta
      theta.upper = theta.hat+delta
      
      data.stats[length(data_list)+1,] = c(theta.hat, theta.se, theta.lower, theta.upper)
      
      combo[[d+1]] = data.stats
    }
    ret[[col_name]] = combo
  }
  return(ret)
}
```

### Studentized Bootstrap CI Code

The Studentized Bootstrap CI uses each bootstrap sample to find a $t$ statistic for that sample, then uses the $\alpha/2$ quantiles of the statistics to find the confidence interval.\newline

$S_1,S_2,...,S_m\sim\text{Data}$\newline

$\hat{\theta}_m=\text{mean}(S_m)$\newline

$R_1^m,R_2^m,...,R_m^m\sim\text{S_m}$\newline

$\hat{\theta}^{(m)}_m=\text{mean}(R_m^m)$

$\hat{\theta}^{(m)}=\text{mean}(R_1^m,R_2^m,...,R_m^m)\text{ and }\hat{\text{se}}(\hat{\theta}^{(m)})=\text{sd}(\hat{\theta}^{(m)}_1,\hat{\theta}^{(m)}_2,...)$\newline

$t_m=\frac{\hat{\theta}^{(m)}-\hat{\theta}}{\hat{\text{se}}(\hat{\theta}^{(m)})}$

$\hat{\theta}=\text{mean}(\hat{\theta}_1,\hat{\theta}_2,...)\text{ and }\hat{\text{se}}(\hat{\theta})=\text{sd}(\hat{\theta}_1,\hat{\theta}_2,...)$\newline

The interval is $\hat{\theta}\pm t_{\alpha/2}\hat{\text{ se}}(\hat{\theta})$ where $t_{\alpha/2}$ comes from the upper on lower quantile of $t_m$. 

```{r StudentTBoot, message=FALSE, warning=FALSE, include=FALSE}
student_t_boot = function(data_list, factors) {
  # For each factor of interest
  ret = list()
  for (col_name in factors) {
    # For no, pre, and diabetes
    combo = list()
    for (d in 0:2) {
      # Theta hat for the whole data set
      data.theta_hat = mean(data.main %>% filter(Diabetes==d) %>% pull(col_name))
      
      data.stats = setNames(data.frame(matrix(ncol = 5, nrow = length(data_list))),
                            c("mean", "se", "t_stat", "lower", "upper"))
      # For each sample
      for (i in 1:length(data_list)) {
        data.sample = data_list[[i]] %>% filter(Diabetes==d) %>% pull(col_name)
        
        # re-sampled data
        data.resample = data.frame(matrix(ncol=length(data.sample)+1, nrow=length(data_list)))
        for (r in 1:length(data_list)){
          resample = sample(data.sample, size=length(data.sample), replace=TRUE)
          data.resample[r,] = cbind(resample, mean(resample))
        }
        data.mean = mean(data.sample)
        data.se = sd(data.resample[,length(data.sample)+1])
        
        data.t_stat = (data.mean-data.theta_hat)/data.se
        
        data.stats[i,] = c(data.mean, data.se, data.t_stat, NA, NA)
      }
      theta.hat = mean(data.stats$mean)
      theta.se = sd(data.stats$mean)
      
      theta.t_stat = (theta.hat-data.theta_hat)/theta.se
      
      theta.lower = theta.hat-abs(quantile(data.stats$t_stat, probs=c(0.05/2))*theta.se)
      theta.upper = theta.hat+abs(quantile(data.stats$t_stat, probs=c(1-0.05/2))*theta.se)
      
      data.stats[length(data_list)+1,] = c(theta.hat, theta.se, theta.t_stat,
                                           theta.lower, theta.upper)
      
      combo[[d+1]] = data.stats
    }
    ret[[col_name]] = combo
  }
  return(ret)
}
```

### Run Bootsrapping

```{r JorAnalysisInit, message=FALSE, warning=FALSE, cache=TRUE, include=FALSE}
# The "m"s we are testing
m_list = c(10,30,50,100,250)
# The "n"s we are testing
n_list = c(10,25,75,125,250)
# Factors of interest
factors_list = c("Income", "BMI", "GenHlth", "HighBP", "AnyHealthcare")

ALL_DATA_norm = list(list(), list(), list(), list(), list())
ALL_DATA_stud = list(list(), list(), list(), list(), list())
BOOT_DATA_norm = list(list(), list(), list(), list(), list())
BOOT_DATA_stud = list(list(), list(), list(), list(), list())
for (i in 1:5) {
  m = m_list[i]
  for (j in 1:5) {
    n = n_list[j]
    
    BOOT_DATA_norm[[i]][[j]] = bootSample(data.main, m, n)
    BOOT_DATA_stud[[i]][[j]] = bootSample(data.main, m, n)
    ALL_DATA_norm[[i]][[j]] = normal_boot(BOOT_DATA_norm[[i]][[j]], factors_list)
    ALL_DATA_stud[[i]][[j]] = student_t_boot(BOOT_DATA_stud[[i]][[j]], factors_list)
  }
}
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
pos_list = c("float_left", "float_left", "left")
title_list = c("No Diabetes", "Pre-Diabetes", "Diabetes")

TABLES_norm = list()
TABLES_stud = list()
for (factor.name in factors_list) {
  for (d in 1:3) {
    MEANS_norm = matrix(nrow=5,ncol=5)
    MEANS_stud = matrix(nrow=5,ncol=5)
    SE_norm = matrix(nrow=5,ncol=5)
    SE_stud = matrix(nrow=5,ncol=5)
    for (i in 1:5) {
      for (j in 1:5) {
        MEANS_norm[i,j] = tail(ALL_DATA_norm[[i]][[j]][[factor.name]][[d]]$mean,1)
        MEANS_stud[i,j] = tail(ALL_DATA_stud[[i]][[j]][[factor.name]][[d]]$mean,1)
        SE_norm[i,j] = tail(ALL_DATA_norm[[i]][[j]][[factor.name]][[d]]$sd,1)
        SE_stud[i,j] = tail(ALL_DATA_stud[[i]][[j]][[factor.name]][[d]]$se,1)
      }
    }
    t_title = paste(factor.name, title_list[d], sep=" and ")
    
    # Tables for standard normal
    ############################
    rownames(SE_norm) = paste("m=",m_list,sep="")
    colnames(SE_norm) = paste("n=",n_list,sep="")
    
    means_norm_table = kable(SE_norm, caption=t_title, digits=3, format = "html") %>%
      kable_styling(full_width=F, position=pos_list[d], font_size=8) %>%
      row_spec(0, bold=T, font_size=10) %>% row_spec(0:5, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "3.5em") %>%
      column_spec(2:6, width = "1em") %>% row_spec(c(1,3,5), color="white", background="grey")
    
    TABLES_norm[[factor.name]][[d]] = means_norm_table
    
    # Tables for student t normal
    ############################
    rownames(SE_stud) = paste("m=",m_list,sep="")
    colnames(SE_stud) = paste("n=",n_list,sep="")
    
    means_stud_table = kable(SE_stud, caption=t_title, digits=3, format = "html") %>%
      kable_styling(full_width=F, position=pos_list[d], font_size=8) %>%
      row_spec(0, bold=T, font_size=10) %>% row_spec(0:5, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "3.5em") %>%
      column_spec(2:6, width = "1em") %>% row_spec(c(1,3,5), color="white", background="grey")
    
    TABLES_stud[[factor.name]][[d]] = means_stud_table
  }
}
```

```{r message=FALSE, warning=FALSE, include=FALSE}
BOOT.norm = ALL_DATA_norm[[5]][[5]]
BOOT.stud = ALL_DATA_stud[[5]][[5]]
```

### Pairs of `m` and `n` values
#### Tables of standard error of our estimators for Standard Normal CI

```{r echo=FALSE, message=FALSE, warning=FALSE}
TABLES_norm[["Income"]][[1]]
TABLES_norm[["Income"]][[2]]
TABLES_norm[["Income"]][[3]]

TABLES_norm[["AnyHealthcare"]][[1]]
TABLES_norm[["AnyHealthcare"]][[2]]
TABLES_norm[["AnyHealthcare"]][[3]]
```

#### Tables of standard error of our estimators for Studentized CI

```{r echo=FALSE, message=FALSE, warning=FALSE}
TABLES_stud[["Income"]][[1]]
TABLES_stud[["Income"]][[2]]
TABLES_stud[["Income"]][[3]]

TABLES_stud[["AnyHealthcare"]][[1]]
TABLES_stud[["AnyHealthcare"]][[2]]
TABLES_stud[["AnyHealthcare"]][[3]]
```

From these tables, as we expected to see, the standard error of $\hat{\theta}$ decreases as our sample size and number of samples increase.

### Income

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Tables for m=250, n=250 ###
# Normal CI table
norm_income_table = rbind("No Diabetes"=tail(BOOT.norm$Income[[1]],1)[,-2],
                          "Pre-Diabetes"=tail(BOOT.norm$Income[[2]],1)[,-2],
                          "Diabetes"=tail(BOOT.norm$Income[[3]],1)[,-2])

norm_income_kable = kable(norm_income_table, caption="Normal CI on Income",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

# Student t table
stud_income_table = rbind("No Diabetes"=tail(BOOT.stud$Income[[1]],1)[,-c(2,3)],
                          "Pre-Diabetes"=tail(BOOT.stud$Income[[2]],1)[,-c(2,3)],
                          "Diabetes"=tail(BOOT.stud$Income[[3]],1)[,-c(2,3)])

stud_income_kable = kable(stud_income_table, caption="Student-t CI on Income",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

norm_income_kable
stud_income_kable
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
income.norm = rbind(cbind("Diabetes"=rep(0,251),"Income"=BOOT.norm[["Income"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"Income"=BOOT.norm[["Income"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"Income"=BOOT.norm[["Income"]][[3]]$mean))
income.norm = as.data.frame(income.norm)
income.norm$Diabetes = as.factor(income.norm$Diabetes)

income.norm.CIspace = seq(0.5, 4, length.out=3)
income_norm_plot = ggplot() +
  geom_histogram(aes(x=income.norm$Income, y=..count../sum(..count..)*100,
                     fill=income.norm$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=norm_income_table$lower, xend=norm_income_table$upper,
                   y=income.norm.CIspace, yend=income.norm.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=norm_income_table$mean, xend=norm_income_table$mean,
                   y=income.norm.CIspace-0.1, yend=income.norm.CIspace+0.1),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Normal CI on Income", x="Income", y="Frequency", fill="Diabetes")

#########################
income.stud = rbind(cbind("Diabetes"=rep(0,251),"Income"=BOOT.stud[["Income"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"Income"=BOOT.stud[["Income"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"Income"=BOOT.stud[["Income"]][[3]]$mean))
income.stud = as.data.frame(income.stud)
income.stud$Diabetes = as.factor(income.stud$Diabetes)

income.stud.CIspace = seq(1,6, length.out=3)
income_stud_plot = ggplot() +
  geom_histogram(aes(x=income.stud$Income, y=..count../sum(..count..)*100,
                     fill=income.stud$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=stud_income_table$lower, xend=stud_income_table$upper,
                   y=income.stud.CIspace, yend=income.stud.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=stud_income_table$mean, xend=stud_income_table$mean,
                   y=income.stud.CIspace-0.1, yend=income.stud.CIspace+0.1),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Student-t CI on Income", x="Income", y="Frequency", fill="Diabetes")

income_norm_plot + income_stud_plot + plot_layout(ncol = 2, guides = "collect")
```

### BMI

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Tables for m=250, n=250 ###
# Normal CI table
norm_BMI_table = rbind("No Diabetes"=tail(BOOT.norm$BMI[[1]],1)[,-2],
                          "Pre-Diabetes"=tail(BOOT.norm$BMI[[2]],1)[,-2],
                          "Diabetes"=tail(BOOT.norm$BMI[[3]],1)[,-2])

norm_BMI_kable = kable(norm_BMI_table, caption="Normal CI on BMI",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

# Student t table
stud_BMI_table = rbind("No Diabetes"=tail(BOOT.stud$BMI[[1]],1)[,-c(2,3)],
                          "Pre-Diabetes"=tail(BOOT.stud$BMI[[2]],1)[,-c(2,3)],
                          "Diabetes"=tail(BOOT.stud$BMI[[3]],1)[,-c(2,3)])

stud_BMI_kable = kable(stud_BMI_table, caption="Student-t CI on BMI",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

norm_BMI_kable
stud_BMI_kable
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
BMI.norm = rbind(cbind("Diabetes"=rep(0,251),"BMI"=BOOT.norm[["BMI"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"BMI"=BOOT.norm[["BMI"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"BMI"=BOOT.norm[["BMI"]][[3]]$mean))
BMI.norm = as.data.frame(BMI.norm)
BMI.norm$Diabetes = as.factor(BMI.norm$Diabetes)

BMI.norm.CIspace = seq(1, 7, length.out=3)
BMI_norm_plot = ggplot() +
  geom_histogram(aes(x=BMI.norm$BMI, y=..count../sum(..count..)*100,
                     fill=BMI.norm$Diabetes), position="identity",bins=35) +
  geom_segment(aes(x=norm_BMI_table$lower, xend=norm_BMI_table$upper,
                   y=BMI.norm.CIspace, yend=BMI.norm.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=norm_BMI_table$mean, xend=norm_BMI_table$mean,
                   y=BMI.norm.CIspace-0.15, yend=BMI.norm.CIspace+0.15),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Normal CI on BMI", x="BMI", y="Frequency", fill="Diabetes")

#########################
BMI.stud = rbind(cbind("Diabetes"=rep(0,251),"BMI"=BOOT.stud[["BMI"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"BMI"=BOOT.stud[["BMI"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"BMI"=BOOT.stud[["BMI"]][[3]]$mean))
BMI.stud = as.data.frame(BMI.stud)
BMI.stud$Diabetes = as.factor(BMI.stud$Diabetes)

BMI.stud.CIspace = seq(1, 10, length.out=3)
BMI_stud_plot = ggplot() +
  geom_histogram(aes(x=BMI.stud$BMI, y=..count../sum(..count..)*100,
                     fill=BMI.stud$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=stud_BMI_table$lower, xend=stud_BMI_table$upper,
                   y=BMI.stud.CIspace, yend=BMI.stud.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=stud_BMI_table$mean, xend=stud_BMI_table$mean,
                   y=BMI.stud.CIspace-0.15, yend=BMI.stud.CIspace+0.15),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Student-t CI on BMI", x="BMI", y="Frequency", fill="Diabetes")

BMI_norm_plot + BMI_stud_plot + plot_layout(ncol = 2, guides = "collect")
```

### GenHlth

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Tables for m=250, n=250 ###
# Normal CI table
norm_GenHlth_table = rbind("No Diabetes"=tail(BOOT.norm$GenHlth[[1]],1)[,-2],
                          "Pre-Diabetes"=tail(BOOT.norm$GenHlth[[2]],1)[,-2],
                          "Diabetes"=tail(BOOT.norm$GenHlth[[3]],1)[,-2])

norm_GenHlth_kable = kable(norm_GenHlth_table, caption="Normal CI on GenHlth",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

# Student t table
stud_GenHlth_table = rbind("No Diabetes"=tail(BOOT.stud$GenHlth[[1]],1)[,-c(2,3)],
                          "Pre-Diabetes"=tail(BOOT.stud$GenHlth[[2]],1)[,-c(2,3)],
                          "Diabetes"=tail(BOOT.stud$GenHlth[[3]],1)[,-c(2,3)])

stud_GenHlth_kable = kable(stud_GenHlth_table, caption="Student-t CI on GenHlth",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

norm_GenHlth_kable
stud_GenHlth_kable
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
GenHlth.norm = rbind(cbind("Diabetes"=rep(0,251),"GenHlth"=BOOT.norm[["GenHlth"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"GenHlth"=BOOT.norm[["GenHlth"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"GenHlth"=BOOT.norm[["GenHlth"]][[3]]$mean))
GenHlth.norm = as.data.frame(GenHlth.norm)
GenHlth.norm$Diabetes = as.factor(GenHlth.norm$Diabetes)

GenHlth.norm.CIspace = seq(1, 6, length.out=3)
GenHlth_norm_plot = ggplot() +
  geom_histogram(aes(x=GenHlth.norm$GenHlth, y=..count../sum(..count..)*100,
                     fill=GenHlth.norm$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=norm_GenHlth_table$lower, xend=norm_GenHlth_table$upper,
                   y=GenHlth.norm.CIspace, yend=GenHlth.norm.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=norm_GenHlth_table$mean, xend=norm_GenHlth_table$mean,
                   y=GenHlth.norm.CIspace-0.1, yend=GenHlth.norm.CIspace+0.1),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Normal CI on GenHlth", x="GenHlth", y="Frequency", fill="Diabetes")

#########################
GenHlth.stud = rbind(cbind("Diabetes"=rep(0,251),"GenHlth"=BOOT.stud[["GenHlth"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"GenHlth"=BOOT.stud[["GenHlth"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"GenHlth"=BOOT.stud[["GenHlth"]][[3]]$mean))
GenHlth.stud = as.data.frame(GenHlth.stud)
GenHlth.stud$Diabetes = as.factor(GenHlth.stud$Diabetes)

GenHlth.stud.CIspace = seq(1, 6, length.out=3)
GenHlth_stud_plot = ggplot() +
  geom_histogram(aes(x=GenHlth.stud$GenHlth, y=..count../sum(..count..)*100,
                     fill=GenHlth.stud$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=stud_GenHlth_table$lower, xend=stud_GenHlth_table$upper,
                   y=GenHlth.stud.CIspace, yend=GenHlth.stud.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=stud_GenHlth_table$mean, xend=stud_GenHlth_table$mean,
                   y=GenHlth.stud.CIspace-0.15, yend=GenHlth.stud.CIspace+0.15),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Student-t CI on GenHlth", x="GenHlth", y="Frequency", fill="Diabetes")

GenHlth_norm_plot + GenHlth_stud_plot + plot_layout(ncol = 2, guides = "collect")
```

### HighBP

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Tables for m=250, n=250 ###
# Normal CI table
norm_HighBP_table = rbind("No Diabetes"=tail(BOOT.norm$HighBP[[1]],1)[,-2],
                          "Pre-Diabetes"=tail(BOOT.norm$HighBP[[2]],1)[,-2],
                          "Diabetes"=tail(BOOT.norm$HighBP[[3]],1)[,-2])

norm_HighBP_kable = kable(norm_HighBP_table, caption="Normal CI on HighBP",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

# Student t table
stud_HighBP_table = rbind("No Diabetes"=tail(BOOT.stud$HighBP[[1]],1)[,-c(2,3)],
                          "Pre-Diabetes"=tail(BOOT.stud$HighBP[[2]],1)[,-c(2,3)],
                          "Diabetes"=tail(BOOT.stud$HighBP[[3]],1)[,-c(2,3)])

stud_HighBP_kable = kable(stud_HighBP_table, caption="Student-t CI on HighBP",
                          digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

norm_HighBP_kable
stud_HighBP_kable
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
HighBP.norm = rbind(cbind("Diabetes"=rep(0,251),"HighBP"=BOOT.norm[["HighBP"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"HighBP"=BOOT.norm[["HighBP"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"HighBP"=BOOT.norm[["HighBP"]][[3]]$mean))
HighBP.norm = as.data.frame(HighBP.norm)
HighBP.norm$Diabetes = as.factor(HighBP.norm$Diabetes)

HighBP.norm.CIspace = seq(1, 8, length.out=3)
HighBP_norm_plot = ggplot() +
  geom_histogram(aes(x=HighBP.norm$HighBP, y=..count../sum(..count..)*100,
                     fill=HighBP.norm$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=norm_HighBP_table$lower, xend=norm_HighBP_table$upper,
                   y=HighBP.norm.CIspace, yend=HighBP.norm.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=norm_HighBP_table$mean, xend=norm_HighBP_table$mean,
                   y=HighBP.norm.CIspace-0.15, yend=HighBP.norm.CIspace+0.15),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Normal CI on HighBP", fill="Diabetes",
       x="HighBP", y="Frequency")

#########################
HighBP.stud = rbind(cbind("Diabetes"=rep(0,251),"HighBP"=BOOT.stud[["HighBP"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),"HighBP"=BOOT.stud[["HighBP"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),"HighBP"=BOOT.stud[["HighBP"]][[3]]$mean))
HighBP.stud = as.data.frame(HighBP.stud)
HighBP.stud$Diabetes = as.factor(HighBP.stud$Diabetes)

HighBP.stud.CIspace = seq(1, 8, length.out=3)
HighBP_stud_plot = ggplot() +
  geom_histogram(aes(x=HighBP.stud$HighBP, y=..count../sum(..count..)*100,
                     fill=HighBP.stud$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=stud_HighBP_table$lower, xend=stud_HighBP_table$upper,
                   y=HighBP.stud.CIspace, yend=HighBP.stud.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=stud_HighBP_table$mean, xend=stud_HighBP_table$mean,
                   y=HighBP.stud.CIspace-0.15, yend=HighBP.stud.CIspace+0.15),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Student-t CI on HighBP", fill="Diabetes",
       x="HighBP", y="Frequency")

HighBP_norm_plot + HighBP_stud_plot + plot_layout(ncol = 2, guides = "collect")
```

### AnyHealthcare

```{r echo=FALSE, message=FALSE, warning=FALSE}
### Tables for m=250, n=250 ###
# Normal CI table
norm_AnyHealthcare_table = rbind("No Diabetes"=tail(BOOT.norm$AnyHealthcare[[1]],1)[,-2],
                          "Pre-Diabetes"=tail(BOOT.norm$AnyHealthcare[[2]],1)[,-2],
                          "Diabetes"=tail(BOOT.norm$AnyHealthcare[[3]],1)[,-2])

norm_AnyHealthcare_kable = kable(norm_AnyHealthcare_table,
                                 caption="Normal CI on AnyHealthcare",
                                 digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

# Student t table
stud_AnyHealthcare_table = rbind("No Diabetes"=tail(BOOT.stud$AnyHealthcare[[1]],1)[,-c(2,3)],
                          "Pre-Diabetes"=tail(BOOT.stud$AnyHealthcare[[2]],1)[,-c(2,3)],
                          "Diabetes"=tail(BOOT.stud$AnyHealthcare[[3]],1)[,-c(2,3)])

stud_AnyHealthcare_kable = kable(stud_AnyHealthcare_table,
                                 caption="Student-t CI on AnyHealthcare",
                                 digits=3, format = "html") %>%
      kable_styling("striped", full_width=F, position="float_left", font_size=10) %>%
      row_spec(0, bold = TRUE, font_size=14, align="c") %>% row_spec(0:3, align="c") %>%
      column_spec(1, bold = TRUE, border_right = TRUE, width = "7em")

norm_AnyHealthcare_kable
stud_AnyHealthcare_kable
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
AnyHealthcare.norm = rbind(cbind("Diabetes"=rep(0,251),
                                 "AnyHealthcare"=BOOT.norm[["AnyHealthcare"]][[1]]$mean),
                    cbind("Diabetes"=rep(1,251),
                          "AnyHealthcare"=BOOT.norm[["AnyHealthcare"]][[2]]$mean),
                    cbind("Diabetes"=rep(2,251),
                          "AnyHealthcare"=BOOT.norm[["AnyHealthcare"]][[3]]$mean))
AnyHealthcare.norm = as.data.frame(AnyHealthcare.norm)
AnyHealthcare.norm$Diabetes = as.factor(AnyHealthcare.norm$Diabetes)

AnyHealthcare.norm.CIspace = seq(1, 15, length.out=3)
AnyHealthcare_norm_plot = ggplot() +
  geom_histogram(aes(x=AnyHealthcare.norm$AnyHealthcare, y=..count../sum(..count..)*100,
                     fill=AnyHealthcare.norm$Diabetes), position="identity", bins=35) +
  geom_segment(aes(x=norm_AnyHealthcare_table$lower, xend=norm_AnyHealthcare_table$upper,
                   y=AnyHealthcare.norm.CIspace, yend=AnyHealthcare.norm.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=norm_AnyHealthcare_table$mean, xend=norm_AnyHealthcare_table$mean,
                   y=AnyHealthcare.norm.CIspace-0.8, yend=AnyHealthcare.norm.CIspace+0.8),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Normal CI on AnyHealthcare", fill="Diabetes",
       x="AnyHealthcare", y="Frequency")

#########################
AnyHealthcare.stud = rbind(cbind("Diabetes"=rep(0,251),
                                 "AnyHealthcare"=BOOT.stud[["AnyHealthcare"]][[1]]$mean),
                           cbind("Diabetes"=rep(1,251),
                                 "AnyHealthcare"=BOOT.stud[["AnyHealthcare"]][[2]]$mean),
                           cbind("Diabetes"=rep(2,251),
                                 "AnyHealthcare"=BOOT.stud[["AnyHealthcare"]][[3]]$mean))
AnyHealthcare.stud = as.data.frame(AnyHealthcare.stud)
AnyHealthcare.stud$Diabetes = as.factor(AnyHealthcare.stud$Diabetes)

AnyHealthcare.stud.CIspace = seq(1, 15, length.out=3)
AnyHealthcare_stud_plot = ggplot() +
  geom_histogram(aes(x=AnyHealthcare.stud$AnyHealthcare, y=..count../sum(..count..)*100,
                     fill=AnyHealthcare.stud$Diabetes),
                 position="identity", bins=35) +
  geom_segment(aes(x=stud_AnyHealthcare_table$lower, xend=stud_AnyHealthcare_table$upper,
                   y=AnyHealthcare.stud.CIspace, yend=AnyHealthcare.stud.CIspace),
               color=c("red", "green","blue"), fill="black", size=1) +
  geom_segment(aes(x=stud_AnyHealthcare_table$mean, xend=stud_AnyHealthcare_table$mean,
                   y=AnyHealthcare.stud.CIspace-0.8, yend=AnyHealthcare.stud.CIspace+0.8),
               color=c("red", "green","blue"), size=0.75) +
  labs(title="Student-t CI on AnyHealthcare", fill="Diabetes",
       x="AnyHealthcare", y="Frequency")

AnyHealthcare_norm_plot + AnyHealthcare_stud_plot + plot_layout(ncol = 2, guides = "collect")
```

### Normal and Studentized Conclusion

From all of these graphs, we can see that the Standard Normal out-preforms the Studentized interval for every factor. I think the size of the Studentized interval can be decreased if we increase the number of samples, but as we went over in class, the distribution of the t-style statistics can be quite extreme. If I had more time, I would explore the distributions of the t-style statistics across different number of samples and sample size (for both levels of bootstrapping).

## BCa

```{r include=FALSE}
set.seed(26)

nodib <- data.main |> 
  filter(Diabetes==0)|>
  select(HighBP, HighChol, BMI, AnyHealthcare, GenHlth, Income)

predib <- data.main |>
  filter(Diabetes==1)|>
  select(HighBP, HighChol, BMI, AnyHealthcare, GenHlth, Income)

dib <- data.main |>
  filter(Diabetes==2)|>
  select(HighBP, HighChol, BMI, AnyHealthcare, GenHlth, Income)

b_means <- function(data,m){
  
  bootstrap_means <- rep(0,m)
  for(row in 1:m){
    row_vector <- data[[row]]
    bootstrap_means[row] <- mean(row_vector)
  }
  return(bootstrap_means)
}
b_sds <- function(data,m){
  
  bootstrap_sds <- rep(0,m)
  for(row in 1:m){
    row_vector <- data[[row]]
    bootstrap_sds[row] <- sd(row_vector)
  }
  return(bootstrap_sds)
}
```

To start out my analysis, I had to figure out how I was going to sample from such 
a massive data set. I used the following function to sample from a selected indicator
with parameters `m` and `n`:
```{r}
f1 <- function(data, m,n){

  bootstrap_data <- list()
  for(i in 1:m){
    temp_sample_ind <- sample(1:length(data), n,replace=TRUE)
    bootstrap_data[[i]] <- data[temp_sample_ind]
  }
  return(bootstrap_data)
}
```

Now that I had my sample, I could start computing my BCa confidence intervals. 
For the BCa algorithm, I wanted to do it by hand. We never did it in class, so I 
wanted to see what the computation would look like. I searched around on the internet,
which led me to this equation provided by : 

I used the equation:

$g(u) = \hat{F}^{-1}(\phi(z_0 + \frac{z_0 + z_u}{1-a(z_0+z_u)}))$

  Lower bound = $g(\alpha/2)$, Upper bound = $g(1-\alpha/2)$
  $\phi$ is the standard normal cdf 
  $\hat{F}$ is the bootstrap cdf
  $z_0 = \phi^{-1}F(\hat{\theta})$, quantile of mean of theta_boot <= theta_hat
  $z_u = \phi^{-1}(u)$, quantiles of our desired bounds 
  
$\hat{a} = \frac{1}{6}\frac{\sum_{i=1}^n I_i^3}{(\sum_{i=1}^n I_i^2)^{3/2}}$
  
$I_i = (n-1)(\hat{\theta}-\hat{\theta}_{-i})$ finite sample jacknife approx.

I implemented $g(u)$ with this code: 

```{r echo=TRUE}
bca_CI <- function(theta_boot,theta_hat,m){

  alpha <- 0.05
  u <- c(alpha/2, 1-alpha/2) 
  z0 <- qnorm(mean(theta_boot <= theta_hat))
  zu <- qnorm(u)
  a <- 0
  #because the sample size of our data set is so large, the computation
  #is too intensive for rstudio to conduct. With such a large data set a should
  #be close to zero anyways, so I elected to choose zero. 
  
  u_adjusted <- pnorm(z0 + (z0+zu)/(1-a*(z0+zu)))
  #u_adjusted <- pnorm(z0 + (z0+zu)/(1-a_approx*(z0+zu))) 
  conf_int <- quantile(theta_boot,u_adjusted)
  return(conf_int)
  
}
```

Originally, I did not have `a` set to zero. I used this function to approximate `a`:
```{r echo=TRUE}
a_est <- function(data,theta_hat){
  n <- length(data)
  I <- rep(NA, n)
for(i in 1:n){
   #Remove ith data point
   xnew <- data[-i]
   #Estimate theta
   theta_jack <- mean(xnew)
   I[i] <- (n-1)*(theta_hat - theta_jack)
}
#Estimate a
  a_hat <- (sum(I^3)/sum(I^2)^1.5)/6
  return(a_hat)
}
```

Now I was ready to perform BCa confidence intervals! I threw in the data of my
selected indicator, and clicked run.

Here is where I started running into problems. My computer ran for about 10 minutes
before I eventually halted the program. Why was this taking so long?

To first check and see if I was doing something wrong, I used the boot.ci package
to compute a BCa confidence interval. However, this also would run and begin taxing 
the memory allocation. I checked the other confidence intervals and noticed that 
they would compute almost immediately. There was something about the BCa computation
that was computationally intensive.

After staring at my code and equation for two days, I finally made a breakthrough. 
`a` has to iterate through every single observation, take (n-1) * (mean of the dataset - 
mean of the dataset with one less observation), and plug it into $I_n$. I realized that this 
computation was happening 253,680 times (the length of the number of observations per 
column in our data set). This was a massive calculation. I read more into what the
acceleration constant actually meant, and realized that it was adjusting for skew 
using the infinitesimal jackknife method, which reasonably approximates `a` with smaller
sample sizes. With a very high `n`, the central limit theorem kicks in, and each indicator is
approximately normally distributed. Thus, with a normal distribution, the skew approaches 
zero as `n` -> infinity. Therefore, I made the choice to set `a` as zero, which effectively
changes my Bias corrected and accelerated confidence intervals to Bias corrected 
confidence intervals. 

With `a` now set to zero, I could start computing confidence intervals. I decided 
to create a master function that sampled from a selected indicator for no diabetes,
pre diabetes, and diabetes, with a vector of all desired boot strap replications and
sample sizes. I also had to include the overall mean for each indicator so it could 
be used in the BCa function call. 
```{r echo=TRUE}
bca_compile <- function(data0,data1,data2,theta_hat1,theta_hat2,theta_hat3,m,n){
  data.stats = setNames(data.frame(matrix(ncol = 12, nrow = length(m)*length(n))),
                 c("mean1", "sd1","ci_1_lower","ci_1_upper","mean2", "sd2","ci_2_lower","ci_2_upper","mean3", "sd3","ci_3_lower","ci_3_upper"))
  row.names(data.stats) <- c("m5,n10","m5,n25","m5,n75","m5,n125","m5,n250","m10,n10","m10,n25","m10,n75","m10,n125","m10,n250","m15,n10","m15,n25","m15,n75","m15,n125","m15,n250","m30,n10","m30,n25","m30,n75","m30,n125","m30,n250","m50,n10","m50,n25","m50,n75","m50,n125","m50,n250")
  counter=1
  bca_CI_means <- data.frame(matrix(ncol=3,nrow=m[5]))
  for(r in 1:length(m)){
    for(c in 1:length(n)){
      b0 <- f1(data0,m[r],n[c])
      b0_mean <- b_means(b0,m[r])
      b0_se <- b_sds(b0,m[r])
  
      b1 <- f1(data1,m[r],n[c])
      b1_mean <- b_means(b1,m[r])
      b1_se <- b_sds(b1,m[r])
      
      b2<- f1(data2,m[r],n[c])
      b2_mean <- b_means(b2,m[r])
      b2_se <- b_sds(b2,m[r])
  
      # b_mean_diff <- rep(NA,m[r])
      # b_se_diff <- rep(NA,m[r])
      # for(i in 1:m[r]){
      #   b_mean_diff[i] <- b0_mean[i]-b1_mean[i]
      #   b_se_diff[i] <- b0_se[i]-b1_se[i]
      # }
      # b_theta_hat_diff <- theta_hat1-theta_hat2
      # 
      # 
      # 
      # b_ci_diff <- bca_CI(b_mean_diff,b_theta_hat_diff,m[r])
      b0_ci <- bca_CI(b0_mean,theta_hat1,m[r])
      b1_ci <- bca_CI(b1_mean,theta_hat2,m[r])
      b2_ci <- bca_CI(b2_mean,theta_hat3,m[r])
      
      data.stats[counter,] <- c(mean(b0_mean),mean(b0_se),b0_ci[1],b0_ci[2],mean(b1_mean),mean(b1_se),b1_ci[1],b1_ci[2],mean(b2_mean),mean(b2_se),b2_ci[1],b2_ci[2])
      counter <- counter + 1
      if(m[r] == 50 & n[c] == 250){
        bca_CI_means[,1] <- b0_mean
        bca_CI_means[,2] <- b1_mean
        bca_CI_means[,3] <- b2_mean
        
      }
    }
  }
  
  
  return(list(data.stats,bca_CI_means))
  
}
```

This function returns a list of two data frames. The first data frame is a master
data frame which has the mean, standard error, and bounds for the BCa confidence
interval for no diabetes, pre-diabetes, and diabetes of a selected indicator, for all
`m` and `n`. The second data frame is a list of the means of each bootstrapped 
sample for `m` = 50 and `n` = 250, which I used to plot the histograms.

Now was time to plot my results and showcase the relationships. I started by 
creating master functions for each variable, as well as creating data frames
with labels so that the data could be plotted and readable. 

```{r echo=TRUE}
m_vec <- c(5,10,15,30,50)
n_vec <- c(10,25,75,125,250)

nodibindic <- rep("No Diabetes",50)
predibindic <- rep("Pre Diabetes",50)
dibindic <- rep("Diabetes",50)
indic <- c(nodibindic,predibindic,dibindic)



a <- bca_compile(nodib$HighBP,predib$HighBP,dib$HighBP,mean(nodib$HighBP),mean(predib$HighBP),mean(dib$HighBP),m_vec,n_vec)
a1 <- a[[1]]
a2 <- a[[2]]
highBP <- c(a2[,1],a2[,2],a2[,3])
#a3 <- cbind(a3,indic)
a3 <- data.frame(highBP,group=indic)

b <- bca_compile(nodib$HighChol,predib$HighChol,dib$HighChol,mean(nodib$HighChol),mean(predib$HighChol),mean(dib$HighChol),m_vec,n_vec)
b1 <- b[[1]]
b2 <- b[[2]]
highChol <- c(b2[,1],b2[,2],b2[,3])
b3 <- data.frame(highChol,group = indic)

c <- bca_compile(nodib$BMI,predib$BMI,dib$BMI,mean(nodib$BMI),mean(predib$BMI),mean(dib$BMI),m_vec,n_vec)
c1 <- c[[1]]
c2 <- c[[2]]
BMI <- c(c2[,1],c2[,2],c2[,3])
c3 <- data.frame(BMI,group=indic)

d <- bca_compile(nodib$AnyHealthcare,predib$AnyHealthcare,dib$AnyHealthcare,mean(nodib$AnyHealthcare),mean(predib$AnyHealthcare),mean(dib$AnyHealthcare),m_vec,n_vec)
d1 <- d[[1]]
d2 <- d[[2]]
AnyHealthcare <- c(d2[,1],d2[,2],d2[,3])
d3 <- data.frame(AnyHealthcare,group=indic)

e <- bca_compile(nodib$GenHlth,predib$GenHlth,dib$GenHlth,mean(nodib$GenHlth),mean(predib$GenHlth),mean(dib$GenHlth),m_vec,n_vec)
e1 <- e[[1]]
e2 <- e[[2]]
GenHlth <- c(e2[,1],e2[,2],e2[,3])
e3 <- data.frame(GenHlth,group=indic)

f <- bca_compile(nodib$Income,predib$Income,dib$Income,mean(nodib$Income),mean(predib$Income),mean(dib$Income),m_vec,n_vec)
f1 <- f[[1]]
f2 <- f[[2]]
Income <- c(f2[,1],f2[,2],f2[,3])
f3 <- data.frame(Income,group=indic)
```

Next, I created a table function that would neatly display the mean, standard error,
and the bounds for a selected bootstrap replication and sample size. I decided
to compare the smallest and largest bootstrap samples to really showcase the power
of boostrapping. The table functions I created are displayed below. 

```{r echo=TRUE}
make_table <- function(data){
  t = setNames(data.frame(matrix(ncol = 4, nrow = 3)), c("Mean", "SD","CI_Low","CI_High"))
  row.names(t) <- c("No Diabetes","Pre Diabetes","Diabetes")
  t[1,1] = data[25,1]
  t[2,1] = data[25,5]
  t[3,1] = data[25,9]
  
  t[1,2] = data[25,2]
  t[2,2] = data[25,6]
  t[3,2] = data[25,10]
  
  t[1,3] = data[25,3]
  t[2,3] = data[25,7]
  t[3,3] = data[25,11]
  
  t[1,4] = data[25,4]
  t[2,4] = data[25,8]
  t[3,4] = data[25,12]
  
  return(t)
}
make_table2 <- function(data){
  t = setNames(data.frame(matrix(ncol = 4, nrow = 3)), c("Mean", "SD","CI_Low","CI_High"))
  row.names(t) <- c("No Diabetes","Pre Diabetes","Diabetes")
  t[1,1] = data[1,1]
  t[2,1] = data[1,5]
  t[3,1] = data[1,9]
  
  t[1,2] = data[1,2]
  t[2,2] = data[1,6]
  t[3,2] = data[1,10]
  
  t[1,3] = data[1,3]
  t[2,3] = data[1,7]
  t[3,3] = data[1,11]
  
  t[1,4] = data[1,4]
  t[2,4] = data[1,8]
  t[3,4] = data[1,12]
  
  return(t)
}

```

Now, it's time to show off the statistical analysis! I formatted each slide to display the 
two tables and a histogram of the bootstrapped means. Over the top of each histogram
is the BCa confidence interval for `m` = 50 and `n` = 250, and directly below it the
BCa confidence interval for `m` = 5 and `n` = 10. With the confidence intervals
over the plots, it is easy to distinguish the statistical significances. 

##                       BCa High Blood Pressure
```{r highBP plot, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}

highBPtable <- make_table(a1)
highBPtable2 <- make_table2(a1)
highBPtable.kable <- kable(highBPtable, caption = "High Blood Pressure m=50 n=250", digits = 3, format = "html") %>%
kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
highBPtable.kable2 <- kable(highBPtable2, caption = "High Blood Pressure m=5 n=10", digits = 3, format = "html") %>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

highBPplot <- ggplot(data=a3,aes(x = highBP,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(a1[25,3]),y=15,xend=(a1[25,4]),yend=15),col="Green")+
  geom_segment(aes(x=(a1[1,3]),y=13,xend=(a1[1,4]),yend=13,),col="Green")+
  geom_segment(aes(x=(a1[25,7]),y=11,xend=(a1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(a1[1,7]),y=9,xend=(a1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(a1[25,11]),y=7,xend=(a1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(a1[1,11]),y=5,xend=(a1[1,12]),yend=5),col = "Red")+
  labs(fill="Diabetes")

highBPtable.kable
highBPtable.kable2
highBPplot
  
```

##                      BCa High Cholesterol
```{r High Cholesterol, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}
highCholtable <- make_table(b1)
highCholtable2 <- make_table2(b1)
highCholtable.kable <- kable(highCholtable, caption = "High Cholesterol m=50 n=250", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
highCholtable.kable2 <- kable(highCholtable2, caption = "High Cholesterol m=5 n=10", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

highCholplot <- ggplot(data=b3,aes(x = highChol,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(b1[25,3]),y=15,xend=(b1[25,4]),yend=15),col = "Green")+
  geom_segment(aes(x=(b1[1,3]),y=13,xend=(b1[1,4]),yend=13),col = "Green")+
  geom_segment(aes(x=(b1[25,7]),y=11,xend=(b1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(b1[1,7]),y=9,xend=(b1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(b1[25,11]),y=7,xend=(b1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(b1[1,11]),y=5,xend=(b1[1,12]),yend=5), col = "Red")+
  labs(fill="Diabetes")

highCholtable.kable
highCholtable.kable2
highCholplot
```

##                              BCa BMI
```{r BMI, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}
BMItable <- make_table(c1)
BMItable2 <- make_table2(c1)
BMItable.kable <- kable(BMItable, caption = "BMI m=50 n=250", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
BMItable.kable2 <- kable(BMItable2, caption = "BMI m=5 n=10", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

BMIplot <- ggplot(data=c3,aes(x = BMI,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(c1[25,3]),y=15,xend=(c1[25,4]),yend=15),col = "Green")+
  geom_segment(aes(x=(c1[1,3]),y=13,xend=(c1[1,4]),yend=13),col = "Green")+
  geom_segment(aes(x=(c1[25,7]),y=11,xend=(c1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(c1[1,7]),y=9,xend=(c1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(c1[25,11]),y=7,xend=(c1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(c1[1,11]),y=5,xend=(c1[1,12]),yend=5), col = "Red")+
  labs(fill="Diabetes")

BMItable.kable
BMItable.kable2
BMIplot
```

##                          BCa Any Healthcare
```{r Any Healthcare, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}
AnyHealthcaretable <- make_table(d1)
AnyHealthcaretable2 <- make_table2(d1)
AnyHealthcare.kable <- kable(AnyHealthcaretable, caption = "Any Healthcare m=50 n=250", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
AnyHealthcare.kable2 <- kable(AnyHealthcaretable2, caption = "Any Healthcare m=5 n=10", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

AnyHealthcareplot <- ggplot(data=d3,aes(x = AnyHealthcare,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(d1[25,3]),y=15,xend=(d1[25,4]),yend=15),col = "Green")+
  geom_segment(aes(x=(d1[1,3]),y=13,xend=(d1[1,4]),yend=13),col = "Green")+
  geom_segment(aes(x=(d1[25,7]),y=11,xend=(d1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(d1[1,7]),y=9,xend=(d1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(d1[25,11]),y=7,xend=(d1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(d1[1,11]),y=5,xend=(d1[1,12]),yend=5), col = "Red")+
  labs(fill="Diabetes")

AnyHealthcare.kable
AnyHealthcare.kable2
AnyHealthcareplot
```

##                          BCa General Health
```{r General Health, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}
GenHlthtable <- make_table(e1)
GenHlthtable2 <- make_table2(e1)
GenHlth.kable <- kable(GenHlthtable, caption = "General Health m=50 n=250", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
GenHlth.kable2 <- kable(GenHlthtable2, caption = "General Health m=5 n=10", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

GenHlthplot <- ggplot(data=e3,aes(x = GenHlth,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(e1[25,3]),y=15,xend=(e1[25,4]),yend=15),col = "Green")+
  geom_segment(aes(x=(e1[1,3]),y=13,xend=(e1[1,4]),yend=13),col = "Green")+
  geom_segment(aes(x=(e1[25,7]),y=11,xend=(e1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(e1[1,7]),y=9,xend=(e1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(e1[25,11]),y=7,xend=(e1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(e1[25,11]),y=5,xend=(e1[25,12]),yend=5), col = "Red")+
  labs(fill="Diabetes")

GenHlth.kable
GenHlth.kable2
GenHlthplot
```

##                             BCa Income
```{r Income, echo=FALSE, fig.height=3.5, fig.width=9, message=FALSE, warning=FALSE}
Incometable <- make_table(f1)
Incometable2 <- make_table2(f1)
Income.kable <- kable(GenHlthtable, caption = "Income m=50 n=250", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="float_left") %>% column_spec(1:5,width="3em")
Income.kable2 <- kable(GenHlthtable2, caption = "Income m=5 n=10", digits = 3, format = "html")%>% kable_styling(full_width=TRUE,position="center") %>% column_spec(1:5,width="3em")

Incomeplot <- ggplot(data=f3,aes(x = Income,fill = group))+
  geom_histogram(bins=40)+
  geom_segment(aes(x=(f1[25,3]),y=15,xend=(f1[25,4]),yend=15),col = "Green")+
  geom_segment(aes(x=(f1[1,3]),y=13,xend=(f1[1,4]),yend=13),col = "Green")+
  geom_segment(aes(x=(f1[25,7]),y=11,xend=(f1[25,8]),yend=11),col = "Blue")+
  geom_segment(aes(x=(f1[1,7]),y=9,xend=(f1[1,8]),yend=9),col = "Blue")+
  geom_segment(aes(x=(f1[25,11]),y=7,xend=(f1[25,12]),yend=7), col = "Red")+
  geom_segment(aes(x=(f1[1,11]),y=5,xend=(f1[1,12]),yend=5), col = "Red")+
  labs(fill="Diabetes")

Income.kable
Income.kable2
Incomeplot
```


# Conclusion

Our ultimate goal was to be able to compare the different bootstrapping methods across a similar field. Bellow we can see the results of each method:

```{r Conclusion1, echo=FALSE, message=FALSE, warning=FALSE}
algos.names = c("Percentile", "Basic", "Normal", "Student-t", "BCa")

#####################################################
conc_table_np = rbind("Income"=c(T,T,T,F,T),
                      "BMI"=c(T,T,T,T,T),
                      "GenHlth"=c(T,T,T,F,T),
                      "HighBP"=c(T,T,T,F,T),
                      "Hlthcare"=c(F,F,F,F,F),
                      "HighChol"=c(T,T,T,T,T))
colnames(conc_table_np) = algos.names
conc_table_np = t(conc_table_np)
conc_kable_np = kable(conc_table_np, caption="No-Pre Difference in Means", format = "html") %>%
  kable_styling(full_width=F, position="float_left", font_size=8) %>%
  row_spec(0, bold=T, font_size=8) %>% row_spec(0:5, align="c") %>%
  column_spec(1, bold = TRUE, border_right = TRUE, width="6em")

#####################################################
conc_table_pd = rbind("Income"=c(T,T,F,F,T),
                      "BMI"=c(T,T,T,T,F),
                      "GenHlth"=c(T,T,T,F,T),
                      "HighBP"=c(T,T,T,T,F),
                      "Hlthcare"=c(T,F,T,F,F),
                      "HighChol"=c(T,T,T,F,F))
colnames(conc_table_pd) = algos.names
conc_table_pd = t(conc_table_pd)
conc_kable_pd = kable(conc_table_pd, caption="Pre-Diab Difference in Means",
                      format = "html") %>%
  kable_styling(full_width=F, position="left", font_size=8) %>%
  row_spec(0, bold=T, font_size=8) %>% row_spec(0:5, align="c") %>%
  column_spec(1, bold = TRUE, border_right = TRUE, width="6em")

#####################################################
conc_table_nd = rbind("Income"=c(F,T,T,F,T),
                      "BMI"=c(T,T,T,F,T),
                      "GenHlth"=c(T,T,T,F,T),
                      "HighBP"=c(T,T,T,F,T),
                      "Hlthcare"=c(T,T,T,T,F),
                      "HighChol"=c(T,T,T,F,T))
colnames(conc_table_nd) = algos.names
conc_table_nd = t(conc_table_nd)
conc_kable_nd = kable(conc_table_nd, caption="No-Diab Difference in Means",
                      format = "html") %>%
  kable_styling(full_width=F, position="center", font_size=8) %>%
  row_spec(0, bold=T, font_size=8) %>% row_spec(0:5, align="c") %>%
  column_spec(1, bold = TRUE, border_right = TRUE, width="6em")
```

```{r Conclusion2, echo=FALSE, message=FALSE, warning=FALSE}
conc_kable_np
conc_kable_pd
conc_kable_nd
```

These tables all describe a similar story: the basic and percentile methods seemed to be the most consistent while the studentized rarely found evidence to reject the hypothesis. The BCa (or BC) method had a similar outcome to studentized.

I would like to point out that the factors of BMI and HighCol had rejected hypothesises even with the underpreforming algorithms.
