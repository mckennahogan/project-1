---
title: "McKenna Analysis - Percentile and Basic "
author: "McKenna Hogan"
date: '2022-11-17'
output: pdf_document
---

```{r libraries}
library(tidyverse)
library(knitr)
library(dplyr)
```

```{r data}
#skewed data
diab.data1<- read_csv("~/STAT400/Project 1/data/diabetes_012_health_indicators_BRFSS2015.csv")
#unskewed data
diab.data2<- 
  read_csv("~/STAT400/Project 1/data/diabetes_binary_5050split_health_indicators_BRFSS2015.csv")
diab.data3<- read_csv("~/STAT400/Project 1/data/diabetes_binary_health_indicators_BRFSS2015.csv")

nodiab.only.1<-diab.data1|>
  filter(Diabetes_012==0)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
prediab.only.1<-diab.data1|>
  filter(Diabetes_012==1)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
diab.only.1<-diab.data1|>
  filter(Diabetes_012==2)|>
  select(HighBP,HighChol,BMI,AnyHealthcare,GenHlth,Income)
```

```{r percentile bootstrap func}
#income, bmi, genhealth, bp, anyhealthcare
#pull size m, n times
percentile_basic_bootstrap<-function(data,m,n){
  for (b in seq_len(n)){
    which.col<-sample(seq_len(m),m,replace=T)
    bootstrap.reps<-data[which.col,]
  }
  #means
  mean.HighBP<-mean(bootstrap.reps$HighBP)
  mean.HighChol<-mean(bootstrap.reps$HighChol)
  mean.BMI<-mean(bootstrap.reps$BMI)
  mean.AnyHealthcare<-mean(bootstrap.reps$AnyHealthcare)
  mean.GenHlth<-mean(bootstrap.reps$GenHlth)
  mean.Income<-mean(bootstrap.reps$Income)
  mean.table<-data.frame(mean.HighBP,mean.HighChol,
                         mean.BMI,mean.AnyHealthcare,mean.GenHlth,mean.Income)
  rownames(mean.table)<-c("mean")
  colnames(mean.table)<-c("High BP","High Chol",
                          "BMI","Any Healthcare","General Health","Income")
  mean.kable<-kable(mean.table,align="c",caption="means",digits=2)
  
  #percentile CI's
  p.CI.HighBP<-c(mean.HighBP-1.96*sqrt((mean.HighBP*(1-mean.HighBP))/m),
                   mean.HighBP+1.96*sqrt((mean.HighBP*(1-mean.HighBP))/m))
  p.CI.HighChol<-c(mean.HighChol-1.96*sqrt((mean.HighChol*(1-mean.HighChol))/m),
                   mean.HighChol+1.96*sqrt((mean.HighChol*(1-mean.HighChol))/m))
  p.CI.BMI<-quantile(bootstrap.reps$BMI,c(.025,.975))
  p.CI.AnyHealthcare<-c(mean.AnyHealthcare-
                          1.96*sqrt((mean.AnyHealthcare*(1-mean.AnyHealthcare))/m),
                   mean.AnyHealthcare+1.96*sqrt((mean.AnyHealthcare*(1-mean.AnyHealthcare))/m))
  p.CI.GenHlth<-quantile(bootstrap.reps$GenHlth,c(.025,.975))
  p.CI.Income<-quantile(bootstrap.reps$Income,c(.025,.975))
  p.CI.table<-data.frame(p.CI.HighBP,p.CI.HighChol,
                         p.CI.BMI,p.CI.AnyHealthcare,p.CI.GenHlth,p.CI.Income)
  colnames(p.CI.table)<-c("High BP","High Chol",
                        "BMI","Any Healthcare","General Health","Income")
  p.CI.kable<-kable(p.CI.table,align="c",caption="percentile CI",digits=2)
  
  #basic CI's
  b.CI.HighBP<-c(2*mean.HighBP-quantile(bootstrap.reps$HighBP,.975),
                 2*mean.HighBP-quantile(bootstrap.reps$HighBP,.025))
  b.CI.HighChol<-c(2*mean.HighChol-quantile(bootstrap.reps$HighChol,.975),
                 2*mean.HighChol-quantile(bootstrap.reps$HighChol,.025))
  b.CI.BMI<-c(2*mean.BMI-quantile(bootstrap.reps$BMI,.975),
                 2*mean.BMI-quantile(bootstrap.reps$BMI,.025))
  b.CI.AnyHealthcare<-c(2*mean.AnyHealthcare-quantile(bootstrap.reps$AnyHealthcare,.975),
                 2*mean.AnyHealthcare-quantile(bootstrap.reps$AnyHealthcare,.025))
  b.CI.GenHlth<-c(2*mean.GenHlth-quantile(bootstrap.reps$GenHlth,.975),
                 2*mean.GenHlth-quantile(bootstrap.reps$GenHlth,.025))
  b.CI.Income<-c(2*mean.Income-quantile(bootstrap.reps$Income,.975),
                 2*mean.Income-quantile(bootstrap.reps$Income,.025))
  b.CI.table<-data.frame(b.CI.HighBP,b.CI.HighChol,
                         b.CI.BMI,b.CI.AnyHealthcare,b.CI.GenHlth,b.CI.Income)
  colnames(b.CI.table)<-c("High BP","High Chol",
                        "BMI","Any Healthcare","General Health","Income")
  b.CI.kable<-kable(b.CI.table,align="c",caption="basic CI",digits=2)

  return(list(bootstrap.reps,mean.kable,p.CI.kable,b.CI.kable))
}
```

```{r returning bootstrap data}
# m=5 samples
percentile.m5.n10<-percentile_basic_bootstrap(diab.only.1,5,10)
percentile.m5.n25<-percentile_basic_bootstrap(diab.only.1,5,25)
percentile.m5.n75<-percentile_basic_bootstrap(diab.only.1,5,75)
percentile.m5.125<-percentile_basic_bootstrap(diab.only.1,5,125)
percentile.m5.250<-percentile_basic_bootstrap(diab.only.1,5,250)

# m=10 samples
percentile.m10.n10<-percentile_basic_bootstrap(diab.only.1,10,10)
percentile.m10.n25<-percentile_basic_bootstrap(diab.only.1,10,25)
percentile.m10.n75<-percentile_basic_bootstrap(diab.only.1,10,75)
percentile.m10.125<-percentile_basic_bootstrap(diab.only.1,10,125)
percentile.m10.250<-percentile_basic_bootstrap(diab.only.1,10,250)

#m=15 samples
percentile.m15.n10<-percentile_basic_bootstrap(diab.only.1,15,10)
percentile.m15.n25<-percentile_basic_bootstrap(diab.only.1,15,25)
percentile.m15.n75<-percentile_basic_bootstrap(diab.only.1,15,75)
percentile.m15.125<-percentile_basic_bootstrap(diab.only.1,15,125)
percentile.m15.250<-percentile_basic_bootstrap(diab.only.1,15,250)

#m=30 samples
percentile.m30.n10<-percentile_basic_bootstrap(diab.only.1,30,10)
percentile.m30.n25<-percentile_basic_bootstrap(diab.only.1,30,25)
percentile.m30.n75<-percentile_basic_bootstrap(diab.only.1,30,75)
percentile.m30.125<-percentile_basic_bootstrap(diab.only.1,30,125)
percentile.m30.250<-percentile_basic_bootstrap(diab.only.1,30,250)

#m=50 samples
percentile.m50.n10<-percentile_basic_bootstrap(diab.only.1,50,10)
percentile.m50.n25<-percentile_basic_bootstrap(diab.only.1,50,25)
percentile.m50.n75<-percentile_basic_bootstrap(diab.only.1,50,75)
percentile.m50.125<-percentile_basic_bootstrap(diab.only.1,50,125)
percentile.m50.250<-percentile_basic_bootstrap(diab.only.1,50,250)

percentile.m50.n10
percentile.m50.n25
percentile.m50.n75
percentile.m50.125
percentile.m50.250
```


```{r old code}
#income, bmi, genhealth, bp, anyhealthcare

# set up the bootstrap
# B <- 1000
# n <- nrow(law)
# theta_hat_star <- numeric(B) # storage
# 
# for(b in seq_len(B)) {
#   ## Your Turn: Do the bootstrap!
#   #get bootstrap dataset
#   idx_star<-sample(seq_len(n),n,replace = T)
#   x_star<-law[idx_star,]
#   
#   #computing teh statistic
#   theta_hat_star[b]<-cor(x_star$lsat,x_star$gpa)
# }
#pull size n, m times
percentile_bootstrap<-function(data,n,m){
  for (b in seq_len(m)){
    which.col<-sample(seq_len(n),n,replace=T)
    bootstrap.reps<-data[which.col,]
  }
  mean.HighBP<-rep(NA,m)
  mean.HighChol<-rep(NA,m)
  mean.BMI<-rep(NA,m)
  mean.AnyHealthcare<-rep(NA,m)
  mean.GenHlth<-rep(NA,m)
  mean.Income<-rep(NA,m)
  for(i in 1:m){
    start_i<-n*(i-1)+1
    end_i<-n*i
    mean.HighBP<-mean(bootstrap.reps$HighBP[start_i:end_i])
    mean.HighChol<-mean(bootstrap.reps$HighChol[start_i:end_i])
    mean.BMI<-mean(bootstrap.reps$BMI[start_i:end_i])
    mean.AnyHealthcare<-mean(bootstrap.reps$AnyHealthcare[start_i:end_i])
    mean.GenHlth<-mean(bootstrap.reps$GenHlth[start_i:end_i])
    mean.Income<-mean(bootstrap.reps$Income[start_i:end_i])
  }
  mean.table<-data.frame(mean.HighBP,mean.HighChol,
                         mean.BMI,mean.AnyHealthcare,mean.GenHlth,mean.Income)
  mean.kable<-kable(mean.table)
  # CI.HighBP<-rep(NA,m)
  # CI.HighChol<-rep(NA,m)
  # CI.BMI<-rep(NA,m)
  # CI.AnyHealthcare<-rep(NA,m)
  # CI.GenHlth<-rep(NA,m)
  # CI.Income<-rep(NA,m)
  # for(i in 1:m){
  #   start_i<-n*(i-1)+1
  #   end_i<-n*i
  #   CI.HighBP<-quantile(bootstrap.reps$HighBP[start_i:end_i],c(.025,.975))
  #   CI.HighChol<-quantile(bootstrap.reps$HighChol[start_i:end_i],c(.025,.975))
  #   CI.BMI<-quantile(bootstrap.reps$BMI[start_i:end_i],c(.025,.975))
  #   CI.AnyHealthcare<-quantile(bootstrap.reps$AnyHealthcare[start_i:end_i],c(.025,.975))
  #   CI.GenHlth<-quantile(bootstrap.reps$GenHlth[start_i:end_i],c(.025,.975))
  #   CI.Income<-quantile(bootstrap.reps$Income[start_i:end_i],c(.025,.975))
  # }
  # 
  return(list(bootstrap.reps,mean.kable))
}
```
